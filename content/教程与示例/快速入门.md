# 快速入门

> **引用文件**
> **本文档中引用的文件**

- [README.md](https://github.com/carla-simulator/carla/blob/ue5-dev/README.md)
- [start_quickstart.md](https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/start_quickstart.md)
- [python_api.md](https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/python_api.md)
- [core_actors.md](https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/core_actors.md)
- [core_world.md](https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/core_world.md)
- [core_map.md](https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/core_map.md)
- [core_sensors.md](https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/core_sensors.md)
- [manual_control.py](https://github.com/carla-simulator/carla/blob/ue5-dev/PythonAPI/examples/manual_control.py)
- [automatic_control.py](https://github.com/carla-simulator/carla/blob/ue5-dev/PythonAPI/examples/automatic_control.py)
- [requirements.txt](https://github.com/carla-simulator/carla/blob/ue5-dev/PythonAPI/examples/requirements.txt)

## 目录

1. [简介](#简介)
2. [系统要求与安装](#系统要求与安装)
3. [启动 CARLA 服务器](#启动carla服务器)
4. [Python API 连接与世界获取](#python-api连接与世界获取)
5. [车辆蓝图选择与生成](#车辆蓝图选择与生成)
6. [自动驾驶车辆控制](#自动驾驶车辆控制)
7. [核心类使用详解](#核心类使用详解)
8. [常见问题与解决方案](#常见问题与解决方案)
9. [总结](#总结)

## 简介

CARLA 是一个开源的自动驾驶仿真平台，旨在支持自动驾驶系统的开发、训练和验证。本指南将指导用户完成 CARLA 仿真的基本设置和首次运行，详细解释如何启动 CARLA 服务器，通过 Python API 连接到仿真环境，并生成第一个自动驾驶车辆。基于`manual_control.py`和`automatic_control.py`示例，提供完整的代码片段，解释客户端连接、世界获取、车辆蓝图选择、车辆生成和基本控制循环的实现。

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/README.md#L1-L215" target="_blank">README.md</a>
- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/start_quickstart.md#L1-L160" target="_blank">start_quickstart.md</a>

## 系统要求与安装

在安装 CARLA 之前，需要满足以下系统要求：

- **操作系统**：CARLA Unreal Engine 5 版本需要最低为**Ubuntu 22.04**或**Windows 11**。
- **GPU**：建议使用 NVIDIA RTX 3000 系列或更高版本，至少 16 GB 显存。
- **磁盘空间**：CARLA 需要 130 GB 的硬盘（或 SSD）空间。
- **Python**：CARLA 支持 Python 3，需要安装`pygame`和`numpy`库。

安装步骤如下：

1. 从 GitHub 下载所需的 CARLA 包。
2. 解压下载的文件，包含预编译的模拟器、Python API 模块和一些示例脚本。
3. 安装 CARLA 客户端库：
   ```sh
   cd CARLA_ROOT/PythonAPI/dist/
   pip3 install carla-*.*.*-cp3**-linux_x86_64.whl
   ```

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/start_quickstart.md#L14-L77" target="_blank">start_quickstart.md</a>

## 启动 CARLA 服务器

启动 CARLA 服务器的步骤如下：

- **Linux**:
  ```sh
  cd path/to/carla/root
  ./CarlaUnreal.sh
  ```
- **Windows**:
  ```sh
  cd path/to/carla/root
  CarlaUnreal.exe
  ```

启动后，将弹出一个窗口，显示 Town 10 的视图。这是**观察者视图**。可以使用鼠标和`WASD`键在城市中飞行，按住右键控制方向。

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/start_quickstart.md#L78-L97" target="_blank">start_quickstart.md</a>

## Python API 连接与世界获取

通过 Python API 连接到 CARLA 服务器并获取世界对象的步骤如下：

1. 导入 CARLA 库并创建客户端：
   ```python
   import carla
   client = carla.Client('localhost', 2000)
   client.set_timeout(10.0)
   ```
2. 获取当前世界对象：
   ```python
   world = client.get_world()
   ```

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/python_api.md#L453-L574" target="_blank">python_api.md</a>
- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/core_world.md#L20-L56" target="_blank">core_world.md</a>

## 车辆蓝图选择与生成

选择车辆蓝图并生成车辆的步骤如下：

1. 获取蓝图库并选择车辆蓝图：
   ```python
   blueprint_library = world.get_blueprint_library()
   vehicle_bp = random.choice(blueprint_library.filter('vehicle.*.*'))
   ```
2. 设置车辆属性：
   ```python
   if vehicle_bp.has_attribute('color'):
       color = random.choice(vehicle_bp.get_attribute('color').recommended_values)
       vehicle_bp.set_attribute('color', color)
   ```
3. 生成车辆：
   ```python
   spawn_points = world.get_map().get_spawn_points()
   vehicle = world.spawn_actor(vehicle_bp, random.choice(spawn_points))
   ```

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/core_actors.md#L20-L117" target="_blank">core_actors.md</a>
- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/PythonAPI/examples/manual_control.py#L257-L297" target="_blank">manual_control.py</a>

## 自动驾驶车辆控制

基于`automatic_control.py`示例，实现自动驾驶车辆控制的步骤如下：

1. 创建行为代理：
   ```python
   agent = BehaviorAgent(vehicle, behavior='normal')
   ```
2. 设置目的地：
   ```python
   destination = random.choice(spawn_points).location
   agent.set_destination(destination)
   ```
3. 运行控制循环：
   ```python
   while True:
       if agent.done():
           break
       control = agent.run_step()
       vehicle.apply_control(control)
   ```

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/PythonAPI/examples/automatic_control.py#L726-L770" target="_blank">automatic_control.py</a>

## 核心类使用详解

### Transform 类

`Transform`类用于表示位置和旋转，包含`Location`和`Rotation`两个属性。例如：

```python
transform = carla.Transform(carla.Location(x=230, y=195, z=40), carla.Rotation(yaw=180))
```

### VehicleControl 类

`VehicleControl`类用于控制车辆，包含油门、刹车、转向等属性。例如：

```python
vehicle.apply_control(carla.VehicleControl(throttle=1.0, steer=-1.0))
```

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/python_api.md#L107-L110" target="_blank">python_api.md</a>
- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/python_api.md#L217-L220" target="_blank">python_api.md</a>

## 常见问题与解决方案

### 连接失败

确保 CARLA 服务器正在运行，并且客户端连接的 IP 地址和端口正确。

### 端口占用

检查 2000 和 2001 端口是否被其他应用程序占用，必要时更改端口。

### 车辆生成失败

确保生成点没有被其他车辆或物体占据，可以使用`map.get_spawn_points()`获取推荐的生成点。

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/start_quickstart.md#L32-L33" target="_blank">start_quickstart.md</a>
- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/core_actors.md#L84-L97" target="_blank">core_actors.md</a>

## 总结

本指南详细介绍了 CARLA 仿真的基本设置和首次运行的步骤，包括启动服务器、连接 Python API、生成车辆和实现自动驾驶控制。通过这些步骤，用户可以快速上手 CARLA 仿真平台，并进行进一步的开发和研究。

**Section sources**

- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/README.md#L1-L215" target="_blank">README.md</a>
- <a href="https://github.com/carla-simulator/carla/blob/ue5-dev/Docs/start_quickstart.md#L1-L160" target="_blank">start_quickstart.md</a>
